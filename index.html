<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cr√©dito Personal - Clientes</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #050505;
      color: #fff;
    }
    header {
      background: linear-gradient(90deg, #7f00ff, #ff00aa);
      padding: 20px;
      text-align: center;
      box-shadow: 0 0 15px rgba(127, 0, 255, 0.5);
    }
    h1 {
      margin: 0;
      font-size: 1.8em;
    }
    .saldo {
      text-align: right;
      padding: 10px 20px;
      font-size: 1.2em;
      font-weight: bold;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { color: #ff00aa; text-shadow: 0 0 5px #ff00aa; }
      50% { color: #7f00ff; text-shadow: 0 0 15px #7f00ff; }
      100% { color: #ff00aa; text-shadow: 0 0 5px #ff00aa; }
    }
    .container {
      padding: 20px;
    }
    .add-btn {
      background: linear-gradient(90deg, #ff00aa, #7f00ff);
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      float: right;
      margin-bottom: 10px;
      box-shadow: 0 0 10px rgba(255, 0, 170, 0.5);
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 20px;
      box-shadow: 0 0 15px rgba(127, 0, 255, 0.3);
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      padding: 15px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 0, 170, 0.2);
      transition: background-color 0.3s ease;
    }
    th {
      background: linear-gradient(90deg, #1a1a1a, #2a2a2a);
      color: #ff00aa;
      font-weight: bold;
      text-transform: uppercase;
    }
    tr:hover td {
      background-color: rgba(127, 0, 255, 0.1);
    }
    .edit-btn {
      background-color: transparent;
      border: 1px solid #ff00aa;
      color: #ff00aa;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .alerta {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #ff00aa;
      color: #000;
      padding: 10px 20px;
      border-radius: 5px;
      font-weight: bold;
      display: none;
      z-index: 2000;
    }
    input, textarea {
      background-color: #0a0a0a;
      color: #fff;
      border: 1px solid #7f00ff;
      border-radius: 4px;
      padding: 10px;
      width: 100%;
      margin-top: 5px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: #1a1a1a;
      padding: 20px;
      border: 1px solid #ff00aa;
      width: 90%;
      max-width: 600px;
      border-radius: 8px;
    }
    .close-btn {
      float: right;
      background-color: #ff00aa;
      color: #000;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 4px;
    }
    .save-mov-btn {
      margin-top: 10px;
      background-color: #7f00ff;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .movimientos-scroll {
      max-height: 250px;
      overflow-y: auto;
      margin-top: 10px;
      border: 1px solid #7f00ff;
      border-radius: 6px;
      box-shadow: inset 0 0 10px rgba(127, 0, 255, 0.2);
    }
    .etiqueta-pagado {
      background-color: #ff0033;
      color: #fff;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin-left: 10px;
      animation: palpitar 2.5s infinite ease-in-out;
    }
    @keyframes palpitar {
      0% { background-color: #ff0033; }
      50% { background-color: #990022; }
      100% { background-color: #ff0033; }
    }
    .edit-icon {
      cursor: pointer;
      margin-left: 8px;
      color: #ff00aa;
    }
  </style>
</head>
<body>
  <div class="container">
    <button class="add-btn" onclick="abrirFormularioCliente()">‚ûï Agregar Cliente</button>
    <table>
      <thead>
        <tr>
          <th>Cliente</th>
          <th>Cr√©dito Personal</th>
          <th>Vencimiento</th>
          <th>Tel√©fono</th>
        </tr>
      </thead>
      <tbody id="clientesTabla"></tbody>
    </table>
  </div>

  <!-- Formulario para agregar cliente -->
  <div class="modal" id="formularioCliente">
    <div class="modal-content">
      <button class="close-btn" onclick="cerrarFormularioCliente()">Cerrar</button>
      <h2>Agregar Cliente</h2>
      <input type="text" id="nombreInput" placeholder="Nombre y apellido" />
      <input type="text" id="dniInput" placeholder="DNI" />
      <input type="number" id="cuotasInput" placeholder="Cantidad de cuotas" />
      <input type="number" id="valorCuotaInput" placeholder="Valor de cada cuota" />
      <input type="date" id="fechaAltaInput" />
      <input type="text" id="equipoInput" placeholder="Equipo vendido" />
      <textarea id="notaInput" placeholder="Nota adicional"></textarea>
      <button class="save-mov-btn" onclick="guardarCliente()">Guardar Cliente</button>
    </div>
  </div>

  <!-- Modal para ver datos del cliente -->
  <div class="modal" id="datosClienteModal">
    <div class="modal-content">
      <button class="close-btn" onclick="cerrarDatosCliente()">Cerrar</button>
      <h2 id="datosTitulo">Datos del Cliente</h2>
      <div id="datosContenido"></div>
      <h3>Movimientos</h3>
      <div class="movimientos-scroll">
        <table>
          <thead><tr><th>Fecha</th><th>Pago</th><th>Entregado</th></tr></thead>
          <tbody id="detalleCliente"></tbody>
        </table>
      </div>
      <input type="date" id="fechaInput" />
      <input type="number" placeholder="Pago" id="pagoInput" />
      <button class="save-mov-btn" onclick="guardarMovimiento()">Registrar Pago</button>
    </div>
  </div>

  <!-- Modal para editar tel√©fono -->
  <div class="modal" id="modalTelefono">
    <div class="modal-content">
      <button class="close-btn" onclick="cerrarModalTelefono()">Cerrar</button>
      <h3>Editar Tel√©fono</h3>
      <input type="text" id="telefonoInput" placeholder="N√∫mero de tel√©fono" />
      <button class="save-mov-btn" onclick="guardarTelefono()">Guardar</button>
    </div>
  </div>

  <!-- Modal para editar vencimiento -->
  <div class="modal" id="modalVencimiento">
    <div class="modal-content">
      <button class="close-btn" onclick="cerrarModalVencimiento()">Cerrar</button>
      <h3>Editar Vencimiento</h3>
      <input type="date" id="vencimientoInput" />
      <button class="save-mov-btn" onclick="guardarVencimiento()">Guardar</button>
    </div>
  </div>

  <!-- Modal para editar nota -->
  <div class="modal" id="modalNota">
    <div class="modal-content">
      <button class="close-btn" onclick="cerrarModalNota()">Cerrar</button>
      <h3>Editar Nota</h3>
      <textarea id="notaEditarInput" placeholder="Nota adicional"></textarea>
      <button class="save-mov-btn" onclick="guardarNota()">Guardar</button>
    </div>
  </div>

  <div id="alerta" class="alerta"></div>
<script>
let clientes = [];
let clienteActual = null;
let indexTelefono = null;
let indexVencimiento = null;
let indexNota = null;

function mostrarAlerta(mensaje) {
  const alerta = document.getElementById("alerta");
  alerta.textContent = mensaje;
  alerta.style.display = "block";
  setTimeout(() => alerta.style.display = "none", 3000);
}

function abrirFormularioCliente() {
  document.getElementById("formularioCliente").style.display = "flex";
}

function cerrarFormularioCliente() {
  document.getElementById("formularioCliente").style.display = "none";
}

function guardarCliente() {
  const nombre = document.getElementById("nombreInput").value.trim();
  const dni = document.getElementById("dniInput").value.trim();
  const cuotas = parseInt(document.getElementById("cuotasInput").value);
  const valorCuota = parseFloat(document.getElementById("valorCuotaInput").value);
  const fechaAlta = document.getElementById("fechaAltaInput").value;
  const equipo = document.getElementById("equipoInput").value.trim();
  const nota = document.getElementById("notaInput").value.trim();

  if (!nombre || !dni || isNaN(cuotas) || isNaN(valorCuota) || !fechaAlta || !equipo) {
    mostrarAlerta("‚ö†Ô∏è Completa todos los campos obligatorios");
    return;
  }

  const totalCredito = cuotas * valorCuota;

  clientes.push({
    nombre,
    dni,
    cuotas,
    valorCuota,
    totalCredito,
    fechaAlta,
    equipo,
    nota,
    telefono: "",
    vencimiento: fechaAlta,
    movimientos: []
  });

  cerrarFormularioCliente();
  actualizarTabla();
  mostrarAlerta("‚úÖ Cliente agregado correctamente");
}

function actualizarTabla() {
  const tabla = document.getElementById("clientesTabla");
  tabla.innerHTML = "";
  let saldo = 0;

  clientes.forEach((cliente, index) => {
    saldo += cliente.totalCredito;
    const vencimiento = formatearFecha(cliente.vencimiento);
    const diasRestantes = calcularDiasRestantes(cliente.vencimiento);
    const totalPagado = cliente.movimientos.reduce((acc, m) => acc + m.pago, 0);

    const fila = document.createElement("tr");
    fila.innerHTML = `
      <td>${cliente.nombre} <span style="cursor:pointer;" onclick="verDatosCliente(${index})">‚öôÔ∏è</span></td>
      <td>${cliente.cuotas} de $${cliente.valorCuota.toLocaleString()} ‚Üí Total: $${cliente.totalCredito.toLocaleString()}
        <span class="etiqueta-pagado">Pagado: $${totalPagado.toLocaleString()}</span>
      </td>
      <td>
        ${vencimiento}
        <span style="cursor:pointer;" onclick="editarVencimiento(${index})">‚úèÔ∏è</span><br>
        <small>Faltan ${diasRestantes} d√≠as</small>
      </td>
      <td>
        ${cliente.telefono || ""}
        <span style="cursor:pointer;" onclick="editarTelefono(${index})">‚úèÔ∏è</span>
      </td>
    `;
    tabla.appendChild(fila);
  });

  document.getElementById("saldoTotal").textContent = saldo.toLocaleString();
}

function verDatosCliente(index) {
  clienteActual = index;
  const cliente = clientes[index];
  document.getElementById("datosTitulo").textContent = `Datos de ${cliente.nombre}`;
  document.getElementById("datosContenido").innerHTML = `
    <p><strong>DNI:</strong> ${cliente.dni}</p>
    <p><strong>Equipo:</strong> ${cliente.equipo}</p>
    <p><strong>Nota:</strong> ${cliente.nota || "Sin nota"} 
      <span class="edit-icon" onclick="editarNota(${index})">‚úèÔ∏è</span></p>
  `;
  actualizarMovimientos();
  document.getElementById("datosClienteModal").style.display = "flex";
}

function editarNota(index) {
  indexNota = index;
  document.getElementById("notaEditarInput").value = clientes[index].nota || "";
  document.getElementById("modalNota").style.display = "flex";
}

function guardarNota() {
  const nuevaNota = document.getElementById("notaEditarInput").value.trim();
  clientes[indexNota].nota = nuevaNota;
  cerrarModalNota();
  verDatosCliente(indexNota);
  mostrarAlerta("üìù Nota actualizada");
}

function cerrarModalNota() {
  document.getElementById("modalNota").style.display = "none";
}

function actualizarMovimientos() {
  const cliente = clientes[clienteActual];
  const tbody = document.getElementById("detalleCliente");
  tbody.innerHTML = "";
  let entregado = 0;

  cliente.movimientos.forEach(mov => {
    entregado += mov.pago;
    const fila = document.createElement("tr");
    fila.innerHTML = `
      <td>${formatearFecha(mov.fecha)}</td>
      <td>$${mov.pago.toLocaleString()}</td>
      <td>$${entregado.toLocaleString()}</td>
    `;
    tbody.appendChild(fila);
  });

  actualizarTabla();
}

function guardarMovimiento() {
  const fecha = document.getElementById("fechaInput").value;
  const pago = parseFloat(document.getElementById("pagoInput").value);

  if (!fecha || isNaN(pago)) {
    mostrarAlerta("‚ö†Ô∏è Ingres√° una fecha y un monto v√°lido");
    return;
  }

  const cliente = clientes[clienteActual];
  cliente.movimientos.push({ fecha, pago });

  document.getElementById("fechaInput").value = "";
  document.getElementById("pagoInput").value = "";

  actualizarMovimientos();
  mostrarAlerta("‚úÖ Movimiento registrado");
}

function editarTelefono(index) {
  indexTelefono = index;
  document.getElementById("telefonoInput").value = clientes[index].telefono || "";
  document.getElementById("modalTelefono").style.display = "flex";
}

function guardarTelefono() {
  const nuevoTelefono = document.getElementById("telefonoInput").value.trim();
  clientes[indexTelefono].telefono = nuevoTelefono;
  cerrarModalTelefono();
  actualizarTabla();
  mostrarAlerta("üìû Tel√©fono actualizado");
}

function cerrarModalTelefono() {
  document.getElementById("modalTelefono").style.display = "none";
}

function editarVencimiento(index) {
  indexVencimiento = index;
  document.getElementById("vencimientoInput").value = clientes[index].vencimiento;
  document.getElementById("modalVencimiento").style.display = "flex";
}

function guardarVencimiento() {
  const nuevaFecha = document.getElementById("vencimientoInput").value;
  if (!nuevaFecha) {
    mostrarAlerta("‚ö†Ô∏è Ingres√° una fecha v√°lida");
    return;
  }
  clientes[indexVencimiento].vencimiento = nuevaFecha;
  cerrarModalVencimiento();
  actualizarTabla();
  mostrarAlerta("üìÖ Vencimiento actualizado");
}

function cerrarModalVencimiento() {
  document.getElementById("modalVencimiento").style.display = "none";
}

function cerrarDatosCliente() {
  document.getElementById("datosClienteModal").style.display = "none";
}

function formatearFecha(fechaISO) {
  const meses = ["enero", "febrero", "marzo", "abril", "mayo", "junio",
    "julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"];
  const fecha = new Date(fechaISO);
  const dia = fecha.getDate().toString().padStart(2, '0');
  const mes = meses[fecha.getMonth()];
  const a√±o = fecha.getFullYear();
  return `${dia} de ${mes} de ${a√±o}`;
}

function calcularDiasRestantes(fecha) {
  const hoy = new Date();
  const venc = new Date(fecha);
  const diff = venc - hoy;
  return Math.max(0, Math.ceil(diff / (1000 * 60 * 60 * 24)));
}

actualizarTabla();
</script>
</body>
</html>

